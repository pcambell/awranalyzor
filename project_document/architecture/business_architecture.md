# 业务架构设计 - Oracle AWR报告分析软件

> 更新时间：2025-06-01 22:15:55 +08:00  
> 版本：v1.0  
> 负责人：AR（架构师）  
> 审核人：PDM（产品经理）

## 1. 业务架构概览

### 1.1 核心业务价值
- **主要价值**：为DBA提供智能化的AWR报告分析，替代人工分析，提升诊断效率
- **次要价值**：历史对比分析，趋势识别，标准化报告输出
- **用户群体**：Oracle数据库管理员、性能优化工程师、数据库顾问

### 1.2 业务流程映射

#### 核心业务流程：AWR报告智能分析
```
用户操作流程：
上传AWR报告 → 文件校验 → 解析处理 → 智能诊断 → 查看结果 → 导出报告

系统处理流程：
[上传模块] → [校验模块] → [解析引擎] → [诊断引擎] → [展示模块] → [导出模块]
     ↓            ↓           ↓           ↓           ↓           ↓
  安全检查     格式验证    版本识别     规则匹配    数据可视化   格式转换
  存储文件     内容清理    数据提取     性能分析    交互展示    文件生成
```

#### 扩展业务流程：历史对比分析
```
选择基准报告 → 选择对比报告 → 执行对比分析 → 查看差异 → 导出对比报告

[历史数据] → [对比引擎] → [差异计算] → [趋势分析] → [可视化展示]
```

### 1.3 业务边界定义

**核心边界（MVP范围）：**
- AWR报告上传与安全校验
- 多版本AWR格式解析（11g/12c/19c）
- 基础性能诊断规则（20+核心规则）
- Web界面展示与交互
- PDF/Excel报告导出

**扩展边界（后续迭代）：**
- ASH报告支持
- 高级诊断规则（机器学习）
- 多数据库类型支持
- 团队协作功能

**边界外（明确不做）：**
- 实时监控功能
- 数据库自动调优
- 其他非Oracle数据库

## 2. 业务实体模型

### 2.1 核心业务实体

```
AWR报告实体：
- 元数据：文件信息、数据库版本、实例类型、时间范围
- 内容数据：性能指标、SQL统计、等待事件、系统统计
- 状态信息：处理状态、错误信息、完成时间

性能指标实体：
- 基础指标：CPU使用率、内存命中率、IO统计
- 业务指标：吞吐量、响应时间、并发连接数
- 诊断指标：等待事件、锁竞争、SQL性能

诊断结果实体：
- 问题级别：严重、警告、信息
- 问题分类：内存、CPU、IO、SQL、配置
- 建议措施：具体的优化建议和最佳实践
```

### 2.2 业务关系模型

```
用户 1:N AWR报告
AWR报告 1:N 性能指标
AWR报告 1:N 诊断结果
AWR报告 N:N 报告对比（多对多关系）
性能指标 1:1 诊断结果（可选关联）
```

## 3. 业务规则定义

### 3.1 数据质量规则
- AWR报告必须包含完整的快照信息
- 时间范围必须合理（建议1-24小时）
- 数据库版本必须在支持范围内
- 实例状态必须正常（非异常关闭期间）

### 3.2 诊断规则优先级
```
严重级别规则（Critical）：
- 缓冲区命中率 < 90%
- CPU使用率 > 90%
- 等待事件占比 > 30%
- 硬解析率 > 20%

警告级别规则（Warning）：
- 缓冲区命中率 < 95%
- CPU使用率 > 70%
- 等待事件占比 > 15%
- 硬解析率 > 10%

信息级别规则（Info）：
- 性能趋势提示
- 配置建议
- 最佳实践推荐
```

### 3.3 业务安全规则
- 用户只能访问自己上传的报告
- 报告数据不包含敏感业务信息
- 文件上传严格校验防止恶意代码
- 导出报告包含水印和时间戳

## 4. 技术架构映射

### 4.1 业务模块到技术模块映射

```
业务模块                技术模块（Django App）
------------------------  -------------------------
用户管理                accounts
文件上传与校验          upload
AWR解析处理            parser
性能诊断分析           analyzer  
报告展示交互           dashboard
报告导出功能           export
历史对比分析           comparison
```

### 4.2 数据流架构

```
数据流向：
HTML文件 → 安全校验 → 格式识别 → 版本解析 → 数据提取 → 
结构化存储 → 规则分析 → 诊断结果 → 可视化展示 → 报告导出

存储策略：
- 原始文件：文件系统存储
- 结构化数据：PostgreSQL存储  
- 缓存数据：Redis存储
- 大文件处理：异步队列（Celery）
```

## 5. 非功能性需求

### 5.1 性能需求
- 文件上传：支持最大100MB AWR报告
- 解析速度：10MB报告 < 30秒完成解析
- 并发用户：支持50个并发用户
- 响应时间：页面加载 < 3秒，API响应 < 1秒

### 5.2 可用性需求
- 系统可用性：99.5%（允许少量维护窗口）
- 容错能力：单点故障不影响核心功能
- 恢复能力：故障后1小时内恢复服务

### 5.3 安全需求
- 身份认证：用户密码策略，会话管理
- 访问控制：基于角色的权限控制
- 数据保护：传输加密，存储加密（敏感字段）
- 审计日志：用户操作日志，系统访问日志

### 5.4 可维护性需求
- 代码质量：单元测试覆盖率 > 70%
- 文档完整：API文档、部署文档、用户手册
- 监控告警：系统监控、错误告警、性能监控
- 可扩展性：模块化设计，支持水平扩展

---

**业务架构合理性确认：**
- ✅ 完整反映DBA工作流程
- ✅ 符合Oracle AWR分析最佳实践  
- ✅ 边界清晰，避免功能蔓延
- ✅ 技术实现可行，风险可控
- ✅ 支持未来扩展，但无过度设计

*更新记录：*
- 2025-06-01 22:15:55 +08:00 - 创建业务架构设计v1.0 - AR, PDM 